---
title: "Religiosity as Influenced by Intersectionality"
shorttitle: "Paper"
abstract: An Abstract
keywords: [keyword1, keyword2]
thanks: Thanks to everyone for checking this out.
reference-section-title: References
bibliography: ../bibliography/project.bib
csl: ../bibliography/chicago-parenthetical.csl
format:
  aog-article-pdf:
    keep-tex: false
    include-in-header: 
      text: |
        \usepackage{dcolumn}
#  submittable-pdf:
#     keep-tex: false
#     fig-pos: "!t"
#     include-in-header: 
#       text: |
#         \usepackage{dcolumn}
  submittable-docx: default
---

```{r}
#| label: setup
#| include: false
library(here)
source(here("utils","check_packages.R"))
source(here("utils","functions.R"))
load(here("data","data_constructed","analytical_data.RData"))
```

# Introduction

  
# Background


# Data and Methods


# Limitations


# Results


# Levels of Educational Attainment
It is best to begin looking at the distribution of educational attainment of respondents.

```{r}
#| Label: fig-Educational_Attainment
#| fig-cap: Level of Educational Attainment Among Respondents. 
gss |>
  ggplot(aes(x=educ_attain, y=after_stat(prop), group=1))+
  geom_bar()+
  scale_y_continuous(labels=scales::percent)+
  labs(x="Education Level Attained", y=NULL, 
       title="Educational Attainment Among Respondents")+
  theme_bw()
```

As shown in @fig-Educational_Attainment 

```{r}
#| label: fig-Educational_Attainment_by_Race
#| fig-cap: Level of Educational Attainment of Respondents by Racial Identification.
gss |>  
  ggplot(aes(x=educ_attain, y=after_stat(prop), group=race, fill=race))+
  geom_bar(position="dodge")+
  #facet_wrap(~race)+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123","red", "blue", "black" ))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Education Level by Racial Identification")+
  coord_flip()+
  theme_bw()
```

As shown in @fig-Educational_Attainment_by_Race 

```{r}
#| label: fig-Education_by_Religious_Affiliation
#| fig-cap: Level of Educational Attainment  of Respondents by Religious Affiliation.
gss |>  
  ggplot(aes(x=educ_attain, y=after_stat(prop), group=relig_affil, fill=relig_affil))+
  geom_bar(position="dodge")+
  #facet_wrap(~race)+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123","red", "blue", "black", "orange", "grey", "pink", "purple" ))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Education Level by Religious Affiliation")+
  coord_flip()+
  theme_bw()
```

As shown in @fig-Education_by_Religious_Affiliation


```{r}
#| label: Educational Attainment Across Religious Affiliation and Race
#| fig-cap: Education_Across_Religious_Affiliation_and_Race
ggplot(gss, aes(x=relig_affil, y=after_stat(prop), fill=educ_attain, group=educ_attain))+
  geom_bar(position = "dodge")+
  facet_wrap(~race)+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Educational Attainment by Religious Affiliation and Race")+
  coord_flip()+
  theme_bw()
```

As seen in @fig-Education_Across_Religious_Affiliation_and_Race


```{r}
#| Label: fig-Religiousity_by_Education_and_Race
#| fig-cap: Religiousity by Repsondents Education Level and Race
gss |>
  group_by(race, educ_attain) |>
  summarize(religiosity=mean(religiosity)) |>
  ungroup() |>
  ggplot(aes(x=race, y=religiosity, fill=educ_attain))+
  geom_col(position="dodge")+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123","red", "blue", "black", "orange", "grey", "pink", "purple"))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Religiosity by Educational Attainment and Race")+
  theme_bw()
```

As shown in @fig-Religiosity_by_Education_and_Race 


```{r}
#| label: 3-way Table of Religiosity by education and race
#| fig-cap: Religiosity_table_by_education_and_race
round(prop.table(table(gss$relig_affil, gss$educ_attain, gss$race),c(2,3)),3)*100
```






# Potential Issues in Measuring Religiosity


# Religious Attendance



```{r}
#| label: fig-Religious_Attendance_by_Religious_Affiliation
#| fig-cap: Religious Attendance by Religious Affiliation
gss |>  
  ggplot(aes(x=relig_attend, y=after_stat(prop), group=relig_affil, fill=relig_affil))+
  geom_bar(position="dodge")+
  #facet_wrap(~race)+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123","red", "blue", "black", "orange", "grey", "pink", "purple" ))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Religious Attendance by Religious Affiliation")+
  coord_flip()+
  theme_bw()
```






```{r}
#| label: fig-Religious_Attendance_by_Respondents_Sex_and_Religious_Affilation
#| fig-cap: Religious Attendence by Respondents Sex and Religious Affiliation
gss |>  
  ggplot(aes(x=relig_attend, y=after_stat(prop), group=resp_sex, fill=resp_sex))+
  geom_bar(position="dodge")+
  facet_wrap(~relig_affil)+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123"))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Religious Attendance by Religious Affiliation and Respondent's Sex")+
  coord_flip()+
  theme_bw()
```



# Measuring Belief in God 



```{r}
#| label: fig-Beleif_in_God_by_Religious_Affiliation
#| fig-cap: Belief in God of Respondents by Religious Afiliation.
gss |>  
  ggplot(aes(x=believe_god, y=after_stat(prop), group=relig_affil, fill=relig_affil))+
  geom_bar(position="dodge")+
  #facet_wrap(~race)+
  #scale_fill_viridis_d()+
  scale_fill_manual(values=c("#154733","#FEE123","red", "blue", "black", "orange", "grey", "pink", "purple" ))+
  scale_y_continuous(labels=scales::percent)+
  labs(x=NULL, y=NULL, 
       title="Belief in god by Religious Affiliation")+
  coord_flip()+
  theme_bw()
```

As seen in @fig-Belief_in_God-by_Religious_Affiliation




# Religiosity Models
  
```{r}
#| label: Stair-step approach for models
ordered_factor <- function(fact_var) {
  ord_fact <- factor(fact_var, ordered=TRUE)
  categories <- levels(fact_var)
  n_cat <- length(categories)
  cont <- matrix(0, n_cat, n_cat-1)
  cont[col(cont)<row(cont)] <- 1
  rownames(cont) <- categories
  colnames(cont) <- paste(categories[2:n_cat], categories[1:(n_cat-1)],
                          sep=" vs. ")
  contrasts(ord_fact) <- cont
  return(ord_fact)
}

```

```{r}
#| label: Stair-step approach for previous table
#| fig-cap: Religiosity_stair_step_table_by_education_and_race
gss$educ_attain <- ordered_factor(gss$educ_attain)
contrasts(gss$educ_attain)
```
  
```{r}
#| Label: Modeling Religiosity 
model1 <- glm(religiosity~educ_attain*age+I(age^2), data=gss)
model2 <- update(model1, .~.+educ_attain*race, data=gss)
model3 <- update(model2, .~.+resp_sex*race, data=gss)
model4 <- update(model3, .~.+relig_affil)
```

```{r}
#| label: fig-Rendering_Models
#| fig-cap: Models of religiosity by education and Race with interaction terms.
#| results: asis
#to print to screen replace texreg with screenreg
screenreg(list(model1, model2, model3, model4),
        custom.coef.names = c("Intercept", "high school vs less than high school", "some college vs high school",
        "bachelors vs some college", "graduate vs bachelors", "age", "age squared", "high school vs less than high school controlling age",
        "some college vs high school controlling age", "bachelors vs some college controlling age", "graduate vs bachelors controlling age",
        "black", "latinX", "asian", "asian/pi", "high school vs less than high school among Black", "some college vs high school among Black",
        "bachelors vs some college among Black", "graduate vs bachelors among Black", "high school vs less than high school among LatinX",
        "some college vs high school among LatinX", "bachelors vs some college among LatinX", "graduate vs bachelors among LatinX",
        "high school vs less than high school among Asian", "some college vs high school among Asian", "bachelors vs some college among Asian",
        "graduate vs bachelors among Asian", "high school vs less than high school among Asian/PI", "some college vs high school among Asian/PI",
        "bachelors vs some college among Asian/PI", "graduate vs bachelors among Asian/PI", "male", "Black Male", "LatinX Male",
        "Asian Male", "Asian/PI Male", "Catholic", "Other Christian", "Jewish", "Muslim", "Buddhist", "Hindu", "Other", "None"),
       digits = 3,
       caption.above=TRUE, 
       include.rsquared=TRUE,
       include.adjrs=FALSE,
       include.nobs=TRUE,
       include.rmse=FALSE)
```

As seen in @fig-Rendering_Models 

```{r}
#| Label: Modeling Religiosity Continued
model5 <- glm(religiosity~resp_sex*race+educ_attain*race, data=gss)
model6 <- update(model5, .~.+resp_age+as.factor(year))
model7 <- update(model6, .~.+relig_affil)
model8 <- update(model7,.~.+relig_affil*resp_sex)
```

```{r}
#| label: fig-Rendering_Models_Continued
#| fig-cap: Models of Religiosity by Education, Race, and Sex with interaction terms.
#| results: asis
#to print to screen replace texreg with screenreg
screenreg(list(model5, model6, model7, model8),
        #custom.coef.names = c("high school", "some college", "bachelors", "graduate",
                             # "black", "latinX", "asian", "asian/pi", "HS*black", ""),
       digits = 3,
       caption.above=TRUE, 
       include.rsquared=TRUE,
       include.adjrs=FALSE,
       include.nobs=TRUE,
       include.rmse=FALSE)
```

As seen in @fig-Rendering_Models_Continued



# Conclusions
 

