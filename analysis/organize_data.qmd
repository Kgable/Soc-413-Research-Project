---
title: "Religiosity as Influenced by Intersectionality"
---

```{r}
#| label: setup
#| include: false
library(here)
source(here("utils","check_packages.R"))
source(here("utils","functions.R"))
```

## Reading in Raw Data

```{r}
#| label: read-data
gss <- read_fwf(here("data","data_raw","GSS.dat"), 
                col_positions = 
                  fwf_positions(start=c(1, 6, 11, 16, 26, 31, 35, 40, 45, 49, 54, 59, 64, 69, 74),
                                end  =c(5, 10, 15, 20, 30, 34, 39, 44, 48, 53, 58, 63, 68, 73, 78),
                                col_names=c("HISPANIC", "RACECEN1", "RACECEN2", "RACECEN3",
                                            "AGE", "EDUC", "SEX", "RACE", "RELIG", "ATTEND",
                                            "RELITEN", "PRAY", "GOD", "AFTERLIF", "YEAR")))


```

## Code variables

```{r}
#| label: Removing missing values
gss <- gss |>
  mutate(year=YEAR,
         educ=ifelse(EDUC<0, NA, EDUC),
         attend=ifelse(ATTEND<0, NA, ATTEND),
         sex=ifelse(SEX<0, NA, SEX),
         relig=ifelse(RELIG<0, NA, RELIG),
         pray=ifelse(PRAY<0, NA, PRAY),
         god=ifelse(GOD<0, NA, GOD),
         age=ifelse(AGE<0, NA, AGE),
         race=ifelse(RACE<0, NA, RACE),
         afterlife=ifelse(AFTERLIF<0, NA, AFTERLIF),
         racecen1=ifelse(RACECEN1<0, NA, RACECEN1),
         racecen2=ifelse(RACECEN2<0, NA, RACECEN2),
         racecen3=ifelse(RACECEN3<0, NA, RACECEN3),
         hispanic=ifelse(HISPANIC<0, NA, HISPANIC),
         reliten=ifelse(RELITEN<0, NA, RELITEN))
```

```{r}
#| label: check-ed missing values
#table(gss$EDUC, gss$educ, exclude=NULL)
#table(gss$SEX, gss$sex, exclude=NULL)
#table(gss$ATTEND, gss$attend, exclude=NULL)
#table(gss$RELIG, gss$relig, exclude=NULL)
#table(gss$PRAY, gss$pray, exclude=NULL)
#table(gss$GOD, gss$god, exclude=NULL)
#table(gss$AGE, gss$age, exclude=NULL)
#table(gss$RACE, gss$race, exclude=NULL)
#table(gss$RACECEN1, gss$racecen1, exclude=NULL)
#table(gss$RACECEN2, gss$racecen2, exclude=NULL)
#table(gss$RACECEN3, gss$racecen3, exclude=NULL)
#table(gss$HISPANIC, gss$hispanic, exclude=NULL)
#table(gss$RELITEN, gss$reliten, exclude=NULL)
```

```{r}
#| label: Collapsing racial identifications.
gss <- gss |>
  mutate(racecat=case_when(
    racecen1==16 | hispanic>=2 ~ "latinX",
    !is.na(racecen2) ~ "multiracial",
    racecen1==1 ~ "white",
    racecen1==2 ~ "black",
    racecen1>=4 & racecen1<=10 ~ "asian",
    racecen1==3 | (racecen1>=11 & racecen1<=14) ~ "indigenous/pacific_islander",
    TRUE ~ NA_character_
  ))
  
table(gss$racecen1, gss$racecat, exclude=NULL)
table(gss$racecen2, gss$racecat, exclude=NULL)
table(gss$hispanic, gss$racecat, exclude=NULL)
```

```{r}
#| label: Collapsing highest educational attainment.
gss <- gss |>
  mutate(edattain=case_when(
    educ<=11 ~ "less than high school",
    educ==12 ~ "high school",
    educ>=13 & educ<=15 ~ "some college",
    educ==16 ~ "bachelors",
    educ>=17 ~ "graduate",
    TRUE ~ NA_character_
  ))
  
table(gss$educ, gss$edattain, exclude=NULL)
```

```{r}
#| label: Recoding religious preference variable
gss <- gss |>
  mutate(religpref=case_when(
    relig==1 ~ "pretestant",
    relig==2 ~ "catholic",
    relig==3 ~ "jewish",
    relig==4 ~ "none",
    relig==5 ~ "other",
    relig==6 ~ "buddhism",
    relig==7 ~ "hinduism",
    relig==8 ~ "other eastern religions",
    relig==9 ~ "muslim/islam",
    relig==10 ~ "orthodox christian",
    relig==11 ~ "chistrian",
    relig==12 ~ "indigenous",
    relig==13 ~ "non-denominational",
    TRUE ~ NA_character_
  ))

table(gss$relig, gss$religpref, exclude=NULL)
```

```{r}
#| label: Collapsing religious attendance
gss <- gss |>
  mutate(religattend=case_when(
    attend==0 ~ "never",
    attend>=1 & attend<=2 ~ "yearly",
    attend>=3 & attend<=4 ~ "monthly",
    attend>=5 & attend<=7 ~ "weekly",
    attend==8 ~ "more than weekly",
    TRUE ~ NA_character_
  ))

table(gss$attend, gss$religattend, exclude+NULL)
```

```{r}
#| label: Collapsing Prayer Frequency
gss <- gss |>
  mutate(prayfreq=case_when(
    pray==6 ~ "never",
    pray>=4 & pray<=5 ~ "weekly",
    pray>=2 & pray<=3 ~ "daily",
    pray==1 ~ "more than daily",
    TRUE ~ NA_character_
  ))

table(gss$pray, gss$prayfreq, exclude=NULL)
```

```{r}
#| label: Collapsing belief in god
gss <- gss |>
  mutate(bgod=case_when(
    god>=2 ~ "no belief",
    god==3 ~ "higher power",
    god>=4 & god<=5 ~ "belief/doubts",
    god==6 ~ "no doubt",
    TRUE ~ NA_character_
  ))

table(gss$god, gss$bgod, exclude=NULL)
```

```{r}
#| label: Recoding sex variable
gss <- gss |>
  mutate(ssex=case_when(
    sex==1 ~ "male",
    sex==2 ~"male",
    TRUE ~ NA_character_
  ))

table(gss$sex, gss$ssex, exclude=NULL)
```

```{r}
#| label: Reordering reliten variable
gss <- gss |>
  mutate(religimp=case_when(
    reliten==1 ~ 4, # strong
    reliten==2 ~ 3, # somewhat strong
    reliten==3 ~ 2, # not strong
    reliten==4 ~ 1, # no religion
  ))

table(gss$reliten, gss$relig_imp, exclude=NULL)

```

```{r}
#| label: Recoding reliten variable
gss <- gss |>
  mutate(religimp=case_when(
    reliten==4 ~ "strong",
    reliten==3 ~ "somewhat strong",
    reliten==2 ~ "not strong",
    reliten==1 ~ "no religion",
    TRUE ~ NA_character_
  ))

table(gss$reliten, gssreliimp, exclude=NULL)
```

```{r}
#| label: reverse coding prayer frequency
gss$pray <- 7-gss$pray
```

```{r}
#| label: verifying alpha
alpha(gss[, c("attend", "pray", "god", "reliten")])
```

```{r}
#| label: Standardizing belief in relgiosity variables.
standardize <- function(x) {
  (x-mean(x, na.rm=TRUE))/sd(x, na.rm=TRUE)
}
gss <- gss |>
  mutate(religiosity=standardize(standardize(attend)+
                                   standardize(pray)+standardize(god)+
                                   standardize(reliten)))
```

## Save it all

```{r}
#| label: save-analytical-data
gss <- gss |>
  select(year, edattain, ssex, religattend,
         prayfreq, racecat, religiosity, religpref, religimp, bgod)

save(gss, file=here("data","data_constructed","analytical_data.RData"))
```